(defpoll vol :interval "1s" "${EWW_CONFIG_DIR}/scripts/audio.sh vol")
(defpoll mic :interval "1s" "${EWW_CONFIG_DIR}/scripts/audio.sh mic")
(defpoll mic_status :interval "1s" "${EWW_CONFIG_DIR}/scripts/audio.sh mic-status")
(defvar brightness 50) 

(defwindow control_panel
  :monitor 0
  :geometry (geometry :x "1%"
                      :y "50px"
                      :width "25%"
                      :anchor "top right")
  :stacking "fg"
  (box :class "control-panel" :orientation "v" :space-evenly false :spacing 20
    
    ; User Profile
    (box :class "profile" :orientation "h" :space-evenly false :spacing 15
      (box :class "face" :style "background-image: url('/home/xynapz/dotfiles/face.jpg');")
      (box :orientation "v" :valign "center"
        (label :class "username" :text "xynapz" :halign "start")
        (label :class "uptime" :text {formattime(EWW_TIME, "%H:%M")} :halign "start")))

    ; Sliders
    (box :class "sliders" :orientation "v" :spacing 15
      (box :orientation "h" :space-evenly false :spacing 10
        (label :text "ğŸ”Š" :class "icon")
        (scale :class "vol-slider" :min 0 :max 100 :value vol :onchange "${EWW_CONFIG_DIR}/scripts/audio.sh speaker-set {}" :hexpand true))
      (box :orientation "h" :space-evenly false :spacing 10
        (label :text "ğŸ™ï¸" :class "icon")
        (scale :class "mic-slider" :min 0 :max 100 :value mic :onchange "${EWW_CONFIG_DIR}/scripts/audio.sh mic-set {}" :hexpand true)
        (button :class "mic-toggle ${mic_status}" :onclick "${EWW_CONFIG_DIR}/scripts/audio.sh mic-toggle" (label :text {mic_status == "mic-on" ? "ğŸ™ï¸" : "ğŸ”‡"})))
      (box :orientation "h" :space-evenly false :spacing 10
        (label :text "ğŸ”†" :class "icon")
        (scale :class "bright-slider" :min 0 :max 100 :value brightness :onchange "brightnessctl s {}%" :hexpand true)))

    ; Quick Toggles
    (box :class "toggles" :orientation "h" :space-evenly true
      (button :class "toggle-btn" :onclick "notify-send 'Wifi Toggled'" "ğŸ“¶")
      (button :class "toggle-btn" :onclick "notify-send 'BT Toggled'" "ğŸ”µ")
      (button :class "toggle-btn" :onclick "notify-send 'DND Toggled'" "ğŸŒ™")
      (button :class "toggle-btn" :onclick "notify-send 'Air Toggled'" "âœˆï¸"))

    ; Power Controls
    (box :class "power-controls" :orientation "h" :space-evenly true
      (button :class "power-btn" :onclick "swaymsg exit" "ğŸšª")
      (button :class "power-btn" :onclick "swaylock" "ğŸ”’")
      (button :class "power-btn" :onclick "reboot" "ğŸ”„")
      (button :class "power-btn dest" :onclick "poweroff" "â»"))))
